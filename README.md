# GAP: **G**W for **A**ugmented **P**lanewaves

All-electron GW and CRPA calculator as an interface to [WIEN2k](http://susi.theochem.tuwien.ac.at/)

## Installation 

To compile `gap` executables
1. modify `make.inc` in `src` according to the target system. The templates for the following architectures have been provided
  - Linux 
  - SunOS
  - AIX 
2. setup the LAPACK and BLAS library in `make.inc`
3. first generate the sequential version by

```bash
$ make seq
```

and then parallel version 

```bash
$ make para   # only subroutines related to parallelization are recompiled
```

   By default, the excutables for the sequential and parallel version are `gap${version}.x` and  `gap${version}-mpi.x`, respectively

4. Modify the alias `awk` in `gap${version}_init` if necessary (as on SunOS) 
   In some systems like SunOS, `awk` does not support `-v < variable = value >` but `nawk` does. 
   In that case, one should change alias for `awk` in `gap${version}_init`


## Usage 

  1. Run a full SCF calculation using WIEN2K 

  2. Prepare gw input files by running the shell script 

```bash
$ gap${version}_init -f <casename> -d <gwdir> -nkp <number of kpoints for gw> ...
```

    `gwdir` is the working diretory for gw calculation. It is recommended that `gwdir` be different from the working directory for scf. 
    More detailed information about the options for `gap${version}_init` is available by

```bash
$ gap${version}_init -h 
```

  3. Modify `<gwdir>/$file.ingw` if necessary 

  4. Run serial executable

```bash
$ gap${version}.x
```

    or MPI executable

```bash
$ mpirun -np 4 gap${version}-mpi.x
```

    in the `gwdir` to start serial and parallel calculations, respectively

  5. To restart a gw calculation, set in the `gw.inp`

```bash
  Restart = T
```

    otherwise it always starts from the beginning no matter whether `$casename.selfx/e` exist or not. (to verify)


## Changes for the input 

   1. The range of bands for which GW quasiparticle energies are calculated 
      is now controled by 
```bash
  emingw = <-2.0 / Ry.>  
  emaxgw = <2.0  / Ry.>
```
    Only states whose LDA energies falls between E_Fermi+emingw and 
    E_Fermi+emaxgw are calculated. To be compatible with previous versions, 
    one can also use 
```bash
  ibgw = <1>
  nbgw = <nomax+nexban>   
```
    to indicate the indices of the lowest and highest band that are calculated.

   2. The input block for `Selfenergy` has changes. So one has to 
    change this block if one wants to use this version of the code to continue 
    previous calculations initiated by old versions. 

```bash
  %Selfenergy 
   <Np>  |   <iopes>   |   <iopac>               
  %
```

    Please check a `gw.inp` sample generated by `gap${version}_init` to know the meaning of each term. 

## FAQ

## Known issues

See [README-issues.md](doc/dev/README-issues.md) for known issues


## Development note

See [README-devnote.md](doc/dev/README-devnote.md) for developer note


